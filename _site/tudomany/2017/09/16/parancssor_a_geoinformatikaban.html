<!DOCTYPE html> <html lang="hu"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <title>Földrajzi adatfeldolgozás a parancssorban: a SAGA GIS és a GDAL</title> <meta name="description" content="A parancssor ismerete elengedhetetlen minden webfejlesztő és geoinformatikus számára! Ebben a tutoriálban a parancssori adatfeldolgozásra mutatok egy példát ..."> <meta lang="hu-HU"> <meta property="og:title" content="Földrajzi adatfeldolgozás a parancssorban: a SAGA GIS és a GDAL"> <meta property="og:url" content="http://localhost:4000/tudomany/2017/09/16/parancssor_a_geoinformatikaban.html"> <meta property="og:site_name" content="Gulácsi András"> <meta property="og:description" content="A parancssor ismerete elengedhetetlen minden webfejlesztő és geoinformatikus számára! Ebben a tutoriálban a parancssori adatfeldolgozásra mutatok egy példát ..."> <meta property="og:image" content="http://i346.photobucket.com/albums/p406/salsa990/android-chrome-512x512_zpsp4waxcic.png"> <meta property="og:type" content="website"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png"> <link rel="manifest" href="/assets/favicon/manifest.json"> <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5"> <meta name="theme-color" content="#ffffff"> <link rel="canonical" href="http://localhost:4000/tudomany/2017/09/16/parancssor_a_geoinformatikaban.html"> <link rel="alternate" type="application/rss+xml" title="New Geographer" href="http://localhost:4000/feed.xml"> <link href="https://fonts.googleapis.com/css?family=Lekton:700|Open+Sans|Tinos&amp;subset=latin-ext" rel="stylesheet" type="text/css"> <!-- CSS style. New Geographer Redux theme (version: 6.0b).--> <link rel="stylesheet" type="text/css" href="/css/basic.css"/> <link rel="stylesheet" type="text/css" href="/css/classes.css"/> <link rel="stylesheet" type="text/css" href="/css/media.css"/> <link rel="stylesheet" type="text/css" href="/css/prism.css"/> <style>/** * Earth globe */ .globe { overflow: hidden; position: absolute; height: 140px; width: 140px; left: 50%; top: 90px; margin-bottom: 0px; border: 0.03125rem solid rgba(130, 130, 130, 0.6); border-radius: 50%; -webkit-transform: translate(-50%, -50%); transform: translate(-50%, -50%); } .globe svg { -webkit-animation: rotation 30s linear 0s infinite; animation: rotation 30s linear 0s infinite; } .globe svg path { stroke: rgba(205, 133, 63, 0.6); } @-webkit-keyframes rotation { from { -webkit-transform: translateX(0); transform: translateX(0); } from { -webkit-transform: translateX(-50%); transform: translateX(-50%); } } @keyframes rotation { from { -webkit-transform: translateX(0); transform: translateX(0); } from { -webkit-transform: translateX(-50%); transform: translateX(-50%); } } </style> <!-- CSS style. Syntax highlight rules for code snippets.--> <link rel="stylesheet" type="text/css" href="/css/prism.css"/> <!-- Important JavaScript code comes here if there is any. --> <script src="/js/prism.js"></script> </head> <body> <div class="page-content"> <div class="wrapper"> <article class="post"> <header class="post-header"> <h1 class="post-title">Földrajzi adatfeldolgozás a parancssorban: a SAGA GIS és a GDAL</h1> <div class="post-date">Írta <a href="/about">Gulácsi András</a>. Dátum: 2017. szeptember 16.</div> </header> <div class="post-content"> <p>A SAGA mozaikszó a System for Automated Geoscientific Analyses (Automatizált Földtudományi Elemző Rendszer) rövidítése. A <a href="http://www.saga-gis.org/en/index.html">SAGA GIS</a> egy C++-ban írt szabad forráskódú térinformatikai szoftver. A legújabb, <strong>5.0</strong>-ás verziót használtam a tutoriálhoz.</p> <p>A <strong>SAGA GIS térinformatikai szoftver</strong> kifejlesztésének ötlete az 1990-es évek végén született meg a németországi Göttingeni Egyetem Természetföldrajzi Tanszékén. A tanszéken futó kutatási projektek középpontjában a raszteres adatok, azon belül is kifejezetten a digitális domborzatmodellek, elemzése volt, amit többek közt a talajtulajdonságok, terep által irányított folyamatok, valamint éghajlati paraméterek modellezésére, előrejelzésére használtak. A SAGA GIS-t tehát kifejezetten raszteres adatokfeldolgozására, elemzésére írták. A SAGA GIS fejlesztése <em>Jürgen Böhner</em> és <em>Olaf Conrad</em> vezetésével történt és történik napjainkban is.</p> <p>A kereskedelmi szoftverek közül az ERDAS Imagine ingyenes alternatívája lehet a SAGA GIS.</p> <p>A <a href="http://www.gdal.org/">GDAL</a> (Geospatial Data Abstraction Library) egy szabad forrású földrajzi adatfeldolgozó szoftverkönyvtár, ami számos vektoros és raszteres adatokat manipuláló modult tartalmaz, amelyek a paranccssorban vagy valamilyen héjalkalmazáson (<a href="https://trac.osgeo.org/osgeo4w/">OSGeo4W Shell</a>) keresztül érhetők el. A gépemen lévő változat a <a href="http://www.qgis.org/hu/site/">Quantum GIS (QGIS)</a> szabad forráskódú térinformatikai szoftver mellett települ fel (ugyanis a QGIS is használja a GDAL moduljait), és az <strong>OSGeo4W Shell</strong> héjalkalmazáson keresztül futtatom. A <strong>GDAL verzióm: 1.11.2</strong> (2015. február 10.). A QGIS 2.8.1-Wien változatot telepítettem fel.</p> <p>A fenti verziójú alkalmazásokat használtam a parancssori szkriptek futtatására, tehát más verziókkal nem 100%, hogy tökéletesen működnek.</p> <h2 id="1-adat-és-módszer">1. Adat és módszer</h2> <p>Egy 15 éves 2000 és 2016 közötti műholdas adatsort használtam fel a parancssorban történő adatfeldolgozás demonstrálására. A NASA Terra műhold MODIS szenzorának <a href="https://lpdaac.usgs.gov/dataset_discovery/modis/modis_products_table/mod13q1_v006">250 méteres felbontású, 16 napos EVI és NDVI kompozitképeit</a> (<code class="highlighter-rouge">MOD13Q1: MODIS/Terra Vegetation Indices 16-Day L3 Global 250 m SIN Grid V005</code>) dolgoztam fel a Duna-Tisza-közi erdőterületekre, melyeket az Európai Uniós <a href="https://www.eea.europa.eu/publications/COR0-landcover">CORINE</a> (Coordination of Information on the Environment) felszínborítási adatbázis segítségével határolt le a témavezetőm (<em>Dr. Kovács Ferenc</em>). Az EU tagállamok nagyjából 6 évente felmérik a felszínborítás változásait különböző felszínborítási kategóriák szerint, 1:100 000-es méretarányban. A <code class="highlighter-rouge">CLC_2000</code> (a 2000-05 közötti), a <code class="highlighter-rouge">CLC_2006</code> (a 2006-11 közötti) és a <code class="highlighter-rouge">CLC_2012</code> (2012-től kezdődő műholdképekre) adatok alapján lettek lehatárolva az erdők.</p> <p>Azokat a 250*250 méteres cellákat válogattuk le, aminek legalább 2/3 részét erdő borította. Külön vizsgáljuk a lomb-, a tűlevelű és az elegyes erdőket. A cél a vegetáció egészségi állapotának monitorozása, valamint trendszerű változásainak kimutatása a szárazodó Homokhátságon március vége és szeptember vége között. Az 1970-es évektől számítva a talajvízkút-hálózat mérései szerint átlagosan 3 méterrel süllyedt a régióban a talajvízszint (a magasabban fekvő térségekben ennél nagyobb csökkenés is megfigyelhető, de kizárólag csak ott).</p> <p>A 16 napos kompozitképeket úgy kell érteni, hogy a 16 nap alatt készült összes felvételből raknak össze egy képet: a legjobb minőségű, azaz tiszta, felhőktől mentes értékeket használják fel minden egyes cellára (képpontra). A legnagyobb hátulütője az optikai (a látható és az infravörös tartományban mérő) szenzoroknak, hogy a felhőkön nem látnak át, szemben a lézeres vagy radaros mérésekkel. A kompozit készítésével sokkal teljesebb adatokat kapunk, hiszen egy hosszabb időszakra nézve valószínűbb, hogy lesznek olyan felhőmentes képek, amelyek lefedik a földfelszín nagy részét, így használható információkhoz jutunk.</p> <p>Az <strong>EVI</strong> (Enhanced Vegetation Index, Továbbfejlesztett Vegetációindex) és az <strong>NDVI</strong> (Normalized Difference Vegetation Index, <a href="https://www.agroinform.hu/gazdasag/hogyan-hasznosithatom-a-vegetacios-index-kepeket-demo-32500-001">Normalizált Vegetációindex</a>) spektrális index. A <a href="http://www.geo.u-szeged.hu/~feri/kornyezeti_informatika/ch10s02.html">spektrális indexek</a> olyan származtatott mérőszámok, amelyek a műholdkép-sávokon (például látható kék, látható zöld, látható vörös, közeli, középhullámú és hosszúhullámú, azaz termális infravörös hullámhossz-tartományú sávok) végzett aritmetikai műveletek (osztás, szorzás, kivonás, összeadás) eredményeképpen állnak elő.</p> <p>A műholdkép sávok értékei reflektancia értékek, vagyis a különböző hullámhossz tartományokban mért, felszínre beérkező és onnan visszaverődő sugárzás hányadosai (0 és 1 közötti értékek lehetnek). Például a hófelszín a beérkező napsugárzás 90%-át veri vissza a látható hullámhossz-tartományban. Ezzel szemben a homok csak 30-40%-ot ver vissza, ezért nem csoda, hogy nyáron nagyon felforrósodik a tűző napon. A különböző felszínek/anyagok másképpen vernek vissza a különböző hullámhosszakon. Ez azért fontos, mert ennek segítségével jól el tudjuk határolni egymástól a felszínborítás-típusokat és feltérképezni a változásokat.</p> <p>A vegetációs indexek segítségével a levélzetben bekövetkező biológiai változásokat számszerűsíthetjük (cifrán mondva: kvantifikálhatjuk). Szoros kapcsolat áll fenn a levélzet klorofilltartalma és a vegetációs indexek értékei között. A vegetációs indexeket az 1970-es évek eleje óta használják a növényzet/biomassza változásainak értékelére (<em>Rouse, J. W. et al. 1973</em>).</p> <p>A klorofill molekulák (klorofill-a és klorofill-b) a zöld színtestekben (kloroplasztisz) találhatók. A kloroplasztisz a szén-dioxidból és a vízből fény hatására cukrot (glükózt) állít elő. Ez a fotoszintézis folyamata. A klorofill molekulák nagyon fontos szerepet töltenek be a növények energiatermelő folyamataiban, ugyanis ezek nyelik el (abszorbeálják) a látható vörös és kék tartományba eső napfényt. (A zöld tartományban viszont nagy a visszaverődés, és innen a levelek zöld színe.) Az így elnyelt fotonok energiáját összegyűjtik és továbbítják a fotoszintézis enzimei, fehérjéi felé.</p> <p><strong>Egészséges vegetáció</strong> esetén magas a klorofilltartalom a levelekben. Ilyenkor <strong>a látható vörös tartományban nagyon alacsony a reflektancia</strong> (a visszaverődés), hiszen a klorofill elnyeli a sugárzást. Ezzel szemben, a közeli infravörös tartományban reflektancia csúcs jelentkezik, ugyanis itt a levélzet erősen visszaverő. <strong>A vegetációindexek a vörös és a közeli infravörös sáv reflektanciaértékei közötti különbségen alapszanak.</strong></p> <p><strong>A hosszan tartó szárazság, illetve aszály hatására</strong> a növény nem jut elegendő vízhez, ezért a levelek elkezdenek sárgulni-barnulni, csökken a klorofill-tartalmuk, a fotoszintetikus aktivitás lecsökken. Ilyenkor <strong>a klorofill kevesebb vörös tartományú fényt nyel el, tehát a reflektancia itt megnő.</strong> Ezzel együtt a közeli infravörös tartományban is csökken egy kicsit a reflektancia, vagyis <strong>kisebb lesz a különbség a két sáv értékei között.</strong> A magasabb vegetációindex értékek nagyobb klorofill tartalmat, míg a kisebbek lecsökkent klorofilltartalmat jeleznek. Másképpen kifejezve, egyenes arányosság áll fenn az indexértékek és a fotoszintetikus aktivitás között.</p> <p>A vegetációs indexek esetén szokás normalizálást alkalmazni, amivel [-1; +1] intervallumba transzformáljuk az értékeket. Ez azért előnyös, mert különböző lejtőszög és megvilágítás hatásait kiküszöbölhetjük vele.</p> <p>Az <a href="https://en.wikipedia.org/wiki/Enhanced_vegetation_index">EVI index</a> a hagyományos NDVI továbbfejlesztett, optimalizált változata, melynek számításához a közeli infravörös és a vörös sávok mellett a kék sávot is felhasználják azon célból, hogy javítsák a talaj háttérjeleket és csökkentsék a légköri befolyásokat, mint például az aeroszol szétszóródást.</p> <p>Itt vannak a vegetációindexek képletei:</p> <p><code class="highlighter-rouge">NDVI = (NIR − Red) / (NIR + Red)</code></p> <p><code class="highlighter-rouge">EVI = G * ((NIR − Red) / (NIR + C1 * Red − C2 * Blue + L))</code></p> <p>ahol <code class="highlighter-rouge">NIR</code> a közeli infravörös sáv (841-876 nm), <code class="highlighter-rouge">Red</code> a látható vörös sáv (620-670 nm) és <code class="highlighter-rouge">Blue</code> a látható kék sáv (459-479 nm). nm: nanométer, <code class="highlighter-rouge">10^-9</code> m. A korrekciós együtthatók értékei <code class="highlighter-rouge">C1 = 6</code>, <code class="highlighter-rouge">C2 = 2,5</code>, <code class="highlighter-rouge">L = 1</code> és <code class="highlighter-rouge">G = 7,5</code>.</p> <h2 id="2-feldolgozás-a-parancssorban">2. Feldolgozás a parancssorban</h2> <p>A Windows parancssorban úgynevezett <a href="https://hu.wikipedia.org/wiki/K%C3%B6tegelt_%C3%A1llom%C3%A1ny">kötegelt állományokat</a> futtatok. Egyszerű és hatékony kis programokat lehet batch-ban írni. Az általában .cmd vagy <strong>.bat</strong> kiterjesztésű kötegelt állományokat (angolból átvett néven <a href="https://hu.wikipedia.org/wiki/Batch_programoz%C3%A1s">batch fájlokat</a>) Windows, OS/2, és MS-DOS rendszerekben szokták használni. Formailag egy szövegfájlhoz hasonlítanak, tartalmuk pedig parancsok (DOS/Windows parancsok) egymásutánja. Futtatásuk a tartalom sorról sorra való olvasásával történik például a <strong>cmd.exe</strong>-vel a Windows operációs rendszer alatt. A SAGA GIS parancssorban is futtatható, de célszerű kötegelt fájlként futtatni az utasítások sorozatát.</p> <h3 id="21-saga-gis-saga_cmd">2.1. SAGA GIS (saga_cmd)</h3> <p>A SAGA GIS moduljai a parancssorban is elérhetők. Ha írunk egy programot vagy egy szkriptet, akkor mindig adjuk meg kommentekben, hogy mit csinál a program, milyen probléma megoldására írtuk! A batch-ban a <code class="highlighter-rouge">REM</code> paranccsal tudunk kommentet elhelyezni a szkriptünkbe. Ezeket a számítógép parancsértelmezője figyelmen kívül hagyja. Az <code class="highlighter-rouge">ECHO</code> (visszhang) parancs üzeneteket jelenít meg a kijelzőn (a kommenteket és a parancsokat). Alapértelmezetten <code class="highlighter-rouge">ON</code> módban van (<code class="highlighter-rouge">ECHO ON</code>), de ki is kapcsolható az <code class="highlighter-rouge">ECHO OFF</code> paranccsal. Az <code class="highlighter-rouge">@</code> jel azt a célt szolgálja hogy az <code class="highlighter-rouge">echo off</code>-ot tartalmazó sorra is kikapcsolja a visszhangot. A parancsokat kisbetűsen és nagybetűsen is írhatjuk.</p> <p>He beírjátok a parancssorba, hogy <code class="highlighter-rouge">help</code>, akkor kilistázza az összes parancsot és rövid leírásukat, valamint útmutatókat a használatukról. Ha pedig a <code class="highlighter-rouge">help parancs_neve</code> sort írátok be, akkor még részletesebb magyarázatot kaptok a parancs használatáról. <a href="https://www.tutorialspoint.com/batch_script/batch_script_quick_guide.htm">Ezen a linken</a> egy jó tutoriált találtok a batch használatáról.</p> <p>A helyi változók a felhasználó által megadott azonosítók, melyek az értékadás során jönnek létre. Értékadás a <code class="highlighter-rouge">SET</code> parancs segítségével történik az alábbi szintaxis szerint: <code class="highlighter-rouge">SET azonosito = ertek</code>. A helyi változók csak az adott programban érvényesek. A változók értéke rejtve marad, ha a visszhang ki van kapcsolva az <code class="highlighter-rouge">echo off</code> parancs segítségével.</p> <p>A környezeti változók (például a <code class="highlighter-rouge">PATH</code> a futtatható fájlok keresési útja) a gép működésére nézve fontos információkat tartalmaznak. A szkriptünkben külső programokat (a SAGA GIS moduljait) futtatunk. Ezeknek vannak bemenő parancssori argumentumai, amiket meg kell adni.</p> <p>Ahhoz, hogy hozzáférjünk a SAGA modulokhoz, ideiglenesen módosítanunk kell a <code class="highlighter-rouge">PATH</code> környezeti változót, hogy az a <strong><code class="highlighter-rouge">saga_cmd.exe</code></strong> elérési útjára mutasson (<code class="highlighter-rouge">set PATH=%PATH%;g:\saga-5.0.0_x64\</code>). Csak így tudjuk meghívni a programot. A <code class="highlighter-rouge">SETLOCAL</code> parancs segítségével lokálissá tehetjük a <code class="highlighter-rouge">PATH</code> változónkat, így csak a szkriptünkben lesz látható, vagyis kívülről nem lesz hozzáférhető.</p> <p>Évenként dolgozom fel az adatokat, tehát minden év esetén módosítani kell egy kicsit a változókat! Itt van a programom eleje:</p><pre><code class="language-batch">REM @ECHO OFF
REM *****************************************************************
REM Create mean and median images and clip them with polygons
REM Author: András Gulácsi
REM E-mail: admin@newgeographer.com
REM Date: September 10th, 2017
REM SAGA GIS és GDAL: Földrajzi adatfeldolgozás a parancssorban
REM http://www.newgeographer.com/tudomany/2017/09/16/parancssor_a_geoinformatikaban.html
REM *****************************************************************
REM *************** PATHS ******************
REM Path to saga_cmd.exe
SETLOCAL
set PATH=%PATH%;g:\saga-5.0.0_x64\

REM Path to working dir
SET WORK=g:\modis\2005\EOV_2005\ndvi\
SET RESULT=g:\modis\TEMP
SET SHAPES=g:\modis\
SET POLYGON=00_l_250_66sz_poli.shp
SET POSTFIX=_00_l
SET YEAR=2005
REM ****************************************
</code></pre><p>Létrehoztam néhány fontos változót a fájlok elérési útjait/nevét eltárolva bennük. A <code class="highlighter-rouge">WORK</code> a bemenő képfájlok (GeoTIFF-ben), a <code class="highlighter-rouge">SHAPES</code> a bemenő shape fájlok elérési útvonala. A <code class="highlighter-rouge">RESULT</code> az eredményfájlok kimenő útvonala, a <code class="highlighter-rouge">POLYGON</code> a shape fájl neve, amivel kivágjuk a mintaterületet a képből. Ez egy poligon típusú vektoros állomány.</p> <p>A következő lépésben <strong>egy <code class="highlighter-rouge">FOR</code> ciklus segítségével beolvassuk a bemenő fájlokat tartalmazó mappánkban található összes .tif állományt, majd átkonvertáljuk azokat a SAGA GIS saját fájlformátumába, .sgrd-be.</strong> A <code class="highlighter-rouge">%WORK%</code> helyére a <code class="highlighter-rouge">WORK</code> változónk tartalma helyettesítődik be. A <code class="highlighter-rouge">*</code> az egy tetszőleges sztringet helyettesít, vagyis tetszőleges nevű, de .tif állományokat olvasunk be.</p> <p>A <code class="highlighter-rouge">saga_cmd io_gdal 0</code> parancs a SAGA GIS <strong>io_gdal</strong> moduljának egyik eszközét hívja meg (raszter importálása). Ezután <strong>a parancssori argumentumokat</strong> kell megadnunk: <code class="highlighter-rouge">-GRIDS</code> (bemenő fájl), <code class="highlighter-rouge">-FILES</code> (eredményfájl), <code class="highlighter-rouge">-TRANSFORM</code> (transzformáció, ez nekünk nem kell). A <code class="highlighter-rouge">%%i</code> az éppen aktuális fájl nevét jelöli. A továbbiakban a .sgrd fájlokkal dolgozunk. A <code class="highlighter-rouge">^</code> <strong>beszúrási jelre</strong> azért van szükség, mert egy sorba kellene írni a parancsot, de a láthatóság kedvéért sortöréseket használtam. A <code class="highlighter-rouge">^</code> jel a sor végéhez hozzáfűzi a következő sort (a beszúrási jel és a rá következő újsor karakter törlődik). Fontos a sorköz a <code class="highlighter-rouge">^</code> előtt!</p><pre><code class="language-batch">FOR /F %%i IN ('dir /b %WORK%\*.tif') DO (

REM Tool: Import Raster
saga_cmd io_gdal 0 ^
-GRIDS=%WORK%\%%i.sgrd ^
-FILES=%WORK%\%%i ^
-TRANSFORM=0

)
</code></pre><p>A modulokról és azok használatáról a <a href="http://www.saga-gis.org/saga_tool_doc/5.0.0/a2z.html">SAGA GIS dokumentációban</a> találhattok bővebb leírást.</p> <p>A raszterállományokra (grid-ek) statisztikákat (átlagképeket, szórást stb.) a <strong>Statistics for Grids</strong> eszközzel számolhatunk. Argumentumként meg kell adni a bemenő grid-eket (amiket az előzőekben .sgrd-be alakítottunk át), valamint azokat a statisztikákat, amiket ki akarunk számolni (<code class="highlighter-rouge">-MEAN</code>, <code class="highlighter-rouge">-PCTL</code>). A <code class="highlighter-rouge">-PCTL</code> a percentilis rövidítése, ehhez tartozik egy másik argumentum (<code class="highlighter-rouge">-PCTL_VAL</code>), ahol meg kell adni, hogy hányadik percentilist akarjuk kiszámítani. Az 50. percentilis a medián, ami egyébként az alapértelmezett érték, tehát meg sem kéne adnunk külön.</p> <p>Viszont van egy problémánk: évenként meg kell adnunk a 13 db kép teljes elérési útvonalát, amit begépelni kényelmetlen és időigényes volna. <code class="highlighter-rouge">FOR</code> ciklust itt nem használhatunk. Ilyenkor mit tehetünk? Van egy fontos alapelvem, ami így szól: <strong>ha lehetséges, akkor mindig térj vissza egy olyan megoldáshoz, amit már ismersz!</strong> Az Excelben mindenki ismeri a függvényeket. Az <code class="highlighter-rouge">ÖSSZEFŰZ()</code> függvény segítségével könnyedén legenerálhatjuk az elérési utakat, és csak az éveket kell átírni. Az összefűzött szöveget pedig egyben bemásoljuk a szkriptünkbe. (Itt zárójelben megjegyzem, ha esetleg valamelyikőtök nem tudná, hogy a .bat fájlokat úgy szerkeszthetjük, hogy átírjuk a fájlkiterjesztést .txt-re.). A grid-ek elérési útvonalait <code class="highlighter-rouge">;</code>-vel kell elválasztanunk egymástól.</p> <p><img src="http://localhost:4000/assets/sagagis/excel.png" class="large" alt="Elérési utak, fájlnevek generálása az ÖSSZEFŰZ() függvény segítségével" /> <br /></p><pre><code class="language-batch">REM Tool: Statistics for Grids

saga_cmd statistics_grid 4 ^
-GRIDS=%WORK%\NDVI2005081_eov_kiv.tif.sgrd;%WORK%\NDVI2005097_eov_kiv.tif.sgrd;%WORK%\NDVI2005113_eov_kiv.tif.sgrd;%WORK%\NDVI2005129_eov_kiv.tif.sgrd;%WORK%\NDVI2005145_eov_kiv.tif.sgrd;%WORK%\NDVI2005161_eov_kiv.tif.sgrd;%WORK%\NDVI2005177_eov_kiv.tif.sgrd;%WORK%\NDVI2005193_eov_kiv.tif.sgrd;%WORK%\NDVI2005209_eov_kiv.tif.sgrd;%WORK%\NDVI2005225_eov_kiv.tif.sgrd;%WORK%\NDVI2005241_eov_kiv.tif.sgrd;%WORK%\NDVI2005257_eov_kiv.tif.sgrd;%WORK%\NDVI2005273_eov_kiv.tif.sgrd ^
-MEAN=%RESULT%\atlag.sgrd ^
-PCTL=%RESULT%\median.sgrd ^
-PCTL_VAL=50
</code></pre><p>Ezután az átlag- és mediánképekből ki kell vágnunk az erdőterületeket a poligonok segítségével. Erre a <code class="highlighter-rouge">shapes_grid</code> modul <strong>Grid vágása poligonnal</strong> eszközét használjuk. Meg kell adni a bemenetet, a kimenetet, a poligonokat tartalmazó shape fájlt és az <code class="highlighter-rouge">-EXTENT</code> argumentumot, ami a kimenő grid terjedelmét határozza meg. Mi ezt <code class="highlighter-rouge">0</code>-ra állítjuk. Ebben az esetben az eredeti terjedelmet megtartjuk. Ez az alapértelmezett beállítás:</p><pre><code class="language-batch">REM Tool: Clip Grid with Polygon

saga_cmd shapes_grid 7 ^
-INPUT=%RESULT%\atlag.sgrd ^
-OUTPUT=%RESULT%\atlag%POSTFIX%.sgrd ^
-POLYGONS=%SHAPES%\%POLYGON% ^
-EXTENT=0

saga_cmd shapes_grid 7 ^
-INPUT=%RESULT%\median.sgrd ^
-OUTPUT=%RESULT%\median%POSTFIX%.sgrd ^
-POLYGONS=%SHAPES%\%POLYGON% ^
-EXTENT=0
</code></pre><p><img src="http://localhost:4000/assets/sagagis/saga_results.png" class="large" alt="A mintaterületek sikeresen kivágva az átlagképből" /></p> <p><br /> Miután eredményül kaptuk a mintaterületünkre kivágott átlag- és mediánképeket, ki kell exportálnunk őket GeoTIFF-be. Ehhez megint csak az <code class="highlighter-rouge">io_gdal</code> modult használjuk. A <code class="highlighter-rouge">-GRIDS</code>-nél az exportálandó grid-et, a <code class="highlighter-rouge">-FILE</code>-nál a kimenő fájlt adjuk meg:</p><pre><code class="language-batch">REM Tool: Export GeoTIFF

saga_cmd io_gdal 2 ^
-GRIDS=%RESULT%\atlag%POSTFIX%.sgrd ^
-FILE=%RESULT%\%YEAR%_atlag%POSTFIX%.tif

saga_cmd io_gdal 2 ^
-GRIDS=%RESULT%\median%POSTFIX%.sgrd ^
-FILE=%RESULT%\%YEAR%_median%POSTFIX%.tif

PAUSE
</code></pre><p>A <code class="highlighter-rouge">PAUSE</code> paranccsal megállítjuk a szkript futását, hogy ne lépjen ki azonnal a konzolból, hanem várja meg egy billentyű lenyomását, és utána lépjen ki. Ez olyan, mint amikor a C-ben a <code class="highlighter-rouge">system("PAUSE");</code> utasítással tesszük ugyanezt. (Megjegyzendő, hogy C-ben <a href="(http://www.cplusplus.com/articles/j3wTURfi/)">nem ajánlom ezt a megoldást</a>, mert erőforrásigényes, nem biztonságos és csak Windows rendszeren működik. Ennél sokkal egyszerűbb a <code class="highlighter-rouge">getchar()</code>-t használni.)</p> <p>A következő részben pedig az idősorok számtani átlagát és egyéb statisztikai jellemzőjét exportáljuk ki szöveges fájlba.</p> <p><br /></p> <h3 id="22-virtuális-raszter-készítése-gdal-ban">2.2. Virtuális raszter készítése GDAL-ban</h3> <p>Először létrehozunk egy virtuális raszter (<a href="http://www.gdal.org/gdal_vrttut.html">.vrt fájl, a GDAL saját formátuma</a>) fájlkatalógust, ami XML formátumban tartalmazza az együtt kezelt képfájlok leíró adatait, de magukat az adatokat nem. Ezt a virtuális rasztert fogjuk megnyitni a SAGA GIS-ben.</p> <p>Nyissunk az OSGeo4W héjalkalmazást és gépeljük be ezt a rövid parancsot egyben:</p> <p><code class="highlighter-rouge">gdalbuildvrt -separate g:\modis\TEMP\raszter\layer_stack.vrt g:\modis\TEMP\raszter\*.tif</code></p> <p><img src="http://localhost:4000/assets/sagagis/shell.png" class="medium" alt="Az OSGeo4W Shell felülete: a gdalbuildvrt használati útmutatója kiíratva" /> <br /></p> <p>A <code class="highlighter-rouge">-separate</code> logikai argumentumot megadva külön sávokba helyezi a képeket (ha ezt lehagynánk, akkor virtuális mozaikot készítene nekünk a GDAL), utána következik a kimenet és a bemenet. Ebben a sorrendben! Az elérési útvonalakat pedig módosítsátok, ha szükséges.</p> <p>Indítsuk el a <strong>saga_gui.exe</strong>-t, utána a menüsorban válasszuk ki a <strong>File -&gt; Open</strong> parancsot (vagy a mappa ikonra is kattinthatunk a fájl megnyitásához) és nyissuk meg a virtuális raszterünket (<code class="highlighter-rouge">layer_stack.vrt</code>)! Utána navigáljunk el ide: <strong>Geoprocessing -&gt; Spatial and Geostatistics -&gt; Grids -&gt; Save Grid Statistics to Table</strong>. Nyissuk meg az eszközt! A <strong>Grid Systems</strong>-nél adjuk meg grid rendszerünket (a raszter terjedelem és felbontás) a legördülő listából. Utána a <strong>Grids</strong>-nél a <code class="highlighter-rouge">...</code> gombra kattintva a felugró kéthasábos ablak bal oldali oszlopában válasszuk ki a képkötegünket és a dupla vagy a szimpla nyílra kattintva pakoljuk át a jobb oldali ablakba (így lesz kiválasztva), majd kattintsunk az oké gombra! A táblázat részt hagyjuk úgy, ahogy van. Végül válasszuk ki, hogy milyen statisztikákat számoljon a képekre, és kattintsunk az okéra.</p> <p><img src="http://localhost:4000/assets/sagagis/saga_gui_1.png" class="large" alt="Grid statisztikák mentése táblázatba eszköz" /> <br /> A létrehozott táblázatra kattintsunk jobb egérgombbal és válasszuk ki a <strong>„mentés mint”</strong> opciót és mentsük el .txt formátumba. Ez utána könnyedén beilleszthető az MS Excel-be vagy más táblázatkezelő szoftverbe.</p> <p><img src="http://localhost:4000/assets/sagagis/saga_gui_2.png" class="large" alt="A statisztikákat tartalmazó táblázat exportálása szöveges formátumba" /> <br /> Feltöltöttem nektek a Google Drive-ra a MODIS minta-adatbázisomat (<a href="https://drive.google.com/open?id=0B8pLujeireG7YjBmWTMtbm85UzQ">modis_sample_data.rar</a>, 561 MB, kitömörítve 2,71 GB), amin gyakorolhatjátok a parancssori adatfeldolgozást. A batch szkriptet megtaláljátok a <a href="https://github.com/SalsaBoy990/saga_gis_batch">saga_gis_batch</a> repository-mban.</p> <p><em><strong>Házi feladat:</strong> Készíts egy tudományos színvonalú elemzést egy tetszőlegesen választott mintaterület erdőiben (pl. Keszthelyi-hegység) bekövetkezett változásokról az NDVI adatok alapján, 2000 és 2016 között! Milyen kapcsolat áll fenn a megfigyelt változások és az éves meteorológiai viszonyok között? (A minta-adatbázisban az ország egész területére megvannak az NDVI-képek.) A Keszthelyi-hegységet azért ajánlom mintaterületnek, mert ott egy igen jelentős erdőpusztulás következett be 2011-től kezdődően.</em></p> <h2 id="ajánlott-irodalom">Ajánlott irodalom</h2> <ol> <li><em>Gulácsi András - Kovács Ferenc</em> (2015). <a href="http://www.tajokologiailapok.szie.hu/pdf/201502/04_Gulacsi_Kovacs.pdf">Aszályvizsgálat lehetősége MODIS műholdképekből számított spektrális indexekkel Magyarországon.</a> Tájökológiai Lapok 13(2), pp. 235-248.</li> <li><em>Gulácsi András - Kovács Ferenc</em> (2015). <a href="http://publicatio.bibl.u-szeged.hu/11921/">Drought monitoring with spectral indices calculated from MODIS satellite images in Hungary.</a> Journal of Environmental Geography 8(3-4), pp. 11-20.</li> <li><em>Rouse, J. W. - Haas, H. R. - Schell, A. J. - Deering, W. D.</em> (1973). <a href="https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19740022614.pdf">Monitoring vegetation systems in the Great Plains with ERTS.</a> Third ERTS Symposium, NASA SP-351 1. pp. 309–317.</li> </ol> </div> <aside class="post-content" role="complementary"> <h2>Kapcsolódó bejegyzések</h2> <div> <ul> <li>Nincsen kapcsolódó cikk.</li> </ul> </div> </aside> </article> <div class="navigation-menu"> <ul id="collapsed-menu"> <li><span id="menu-button"> <svg height="15px" width="18px" viewBox="0 0 18 15"> <path fill="#99a" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/> <path fill="#99a" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/> <path fill="#99a" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/> </svg> Menü</span> <ul id="dropdown"> <li> <a href="http://localhost:4000">Kezdőlap</a> </li> <li> <a href="/writings/">Írásaim</a> </li> <li> <a href="/about/">Magamról</a> </li> <li> <a href="/book/">Könyv</a> </li> <li> <a href="https://www.facebook.com/newgeographer">Közösség</a> </li> </ul> </li> </ul> <ul id="full-menu"> <li> <a href="http://localhost:4000">Kezdőlap</a> </li> <li> <a href="/writings/">Írásaim</a> </li> <li> <a href="/about/">Magamról</a> </li> <li> <a href="/book/">Könyv</a> </li> <li> <a href="https://www.facebook.com/newgeographer">Közösség</a> </li> </ul> </div> <!--<span> <div class="copyright"> <span>&copy; Gulácsi András 2017</span> </div></span> <span id="top" style="float:right;color:#828282">Fel<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#828282" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <line x1="12" y1="20" x2="12" y2="4"/> <polyline points="6 10 12 4 18 10"/> </svg></span>--> </div> </div> <!-- jQuery here --> <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"> </script> <script type="text/javascript"> $(document).ready(function () { $("#menu-button").on("click", function() { $("#dropdown").slideToggle(); }); $('table tr:even').addClass('color'); $("table tr").filter(":first").css("font-weight", "600"); }); </script> </body> </html>
